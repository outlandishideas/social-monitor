services:
    pdo:
        class: PDO
        arguments:
            dsn: "mysql:host=%db.host%;dbname=%db.name%"
            user: "%db.username%"
            password: "%db.password%"

    translation.message-selector:
        class: Symfony\Component\Translation\MessageSelector

    translation.csv-loader:
        class: Symfony\Component\Translation\Loader\CsvFileLoader

    translation.translator:
        class: Symfony\Component\Translation\Translator
        arguments: ["en", "@translation.message-selector"]
        calls:
            - [addLoader, ["csv", "@translation.csv-loader"]]
            - [addResource, ["csv", "languages/lang.en.csv", 'en']]

    guzzle.client:
        class: GuzzleHttp\Client

    ###################################
    # report services
    ###################################
    report.downloader:
        class: Outlandish\SocialMonitor\Report\ReportDownloader
        arguments: ["%pdf.base_url%", "%report.base_url%"]

    ###################################
    # adapters
    ###################################
    adapter.facebook:
        class: Outlandish\SocialMonitor\Adapter\FacebookAdapter
        arguments: ["@facebook.app"]

    adapter.instagram:
        class: Outlandish\SocialMonitor\Adapter\InstagramAdapter
        arguments: ["@instagram.app"]

    adapter.youtube:
        class: Outlandish\SocialMonitor\Adapter\YoutubeAdapter
        arguments: ["@google.youtube"]

    adapter.linkedin:
        class: Outlandish\SocialMonitor\Adapter\LinkedinAdapter
        arguments: ["@linkedin.client"]

    adapter.twitter:
        class: Outlandish\SocialMonitor\Adapter\TwitterAdapter
        arguments: ["%twitter.fetch_per_page%"]

    ###################################
    # providers
    ###################################
    provider.twitter:
        class: Provider_Twitter
        arguments: ["@pdo", "@adapter.twitter", "@presence-type.twitter"]

    provider.facebook:
        class: Provider_Facebook
        arguments: ["@pdo", "@adapter.facebook", "@facebook_engagement.weighted", "@presence-type.facebook"]

    provider.instagram:
        class: Provider_Instagram
        arguments: ["@pdo", "@adapter.instagram", "@presence-type.instagram"]

    provider.youtube:
        class: Provider_Youtube
        arguments: ["@pdo", "@adapter.youtube", "@presence-type.youtube"]

    provider.linkedin:
        class: Provider_Linkedin
        arguments: ["@pdo", "@adapter.linkedin", "@presence-type.linkedin"]

    provider.sinaweibo:
        class: Provider_SinaWeibo
        arguments: ["@pdo", "@presence-type.sina-weibo"]

    ###################################
    # instagram engagement services
    ###################################
    instagram.app:
        class: Outlandish\SocialMonitor\InstagramApp
        arguments: ["%instagram.app_token%"]

    instagram.query.weighted:
        class:     Outlandish\SocialMonitor\Engagement\Query\WeightedInstagramEngagementQuery
        arguments: ["@pdo"]


    ###################################
    # linked in api services
    ###################################

    linkedin.client:
        class: LinkedIn\LinkedIn
        arguments:
            -
                api_key: "%linkedin.client_id%"
                api_secret: "%linkedin.client_secret%"
                callback_url: "%linkedin.redirect_url%"

    ###################################
    # google api services
    ###################################

    google.client:
        class: Google_Client
        calls:
            - [setApplicationName, ["Social_Monitor"]]
            - [setDeveloperKey, ["%youtube.api_key%"]]

    google.youtube:
        class: Google_Service_YouTube
        arguments: ["@google.client"]

    ###################################
    # sina weibo engagement services
    ###################################
    sina_weibo.engagement.query.weighted:
        class: Outlandish\SocialMonitor\Engagement\Query\WeightedSinaWeiboEngagementQuery
        arguments: ["@pdo"]

    sina_weibo.engagement.weighted:
        class:     Outlandish\SocialMonitor\Engagement\EngagementMetric
        arguments: ["@sina_weibo.engagement.query.weighted"]

    ###################################
    # facebook engagement services
    ###################################
    facebook_engagement.query.standard:
        class:     Outlandish\SocialMonitor\Engagement\Query\StandardFacebookEngagementQuery
        arguments: ["@pdo"]

    facebook_engagement.query.weighted:
        class:     Outlandish\SocialMonitor\Engagement\Query\WeightedFacebookEngagementQuery
        arguments: ["@pdo"]

    facebook_engagement.standard:
        class:     Outlandish\SocialMonitor\Engagement\EngagementMetric
        arguments: ["@facebook_engagement.query.standard"]

    facebook_engagement.weighted:
        class:     Outlandish\SocialMonitor\Engagement\EngagementMetric
        arguments: ["@facebook_engagement.query.weighted"]

    facebook.session_factory:
        class: Outlandish\SocialMonitor\FacebookFetcher\SessionFactory
        arguments: ["%facebook.app_id%", "%facebook.app_secret%"]

    facebook.request_factory:
        class: Outlandish\SocialMonitor\FacebookFetcher\RequestFactory
        arguments: ["@facebook.session_factory"]

    facebook.likes_counter:
        class: Outlandish\SocialMonitor\FacebookFetcher\LikesCountFetcher
        arguments: ["@facebook.request_factory"]

    facebook.comments_counter:
        class: Outlandish\SocialMonitor\FacebookFetcher\CommentsCountFetcher
        arguments: ["@facebook.request_factory"]

    facebook.feed_fetcher:
        class: Outlandish\SocialMonitor\FacebookFetcher\FeedFetcher
        arguments: ["@facebook.request_factory", "@facebook.post_parser"]

    facebook.post_parser:
        class: Outlandish\SocialMonitor\FacebookFetcher\PostParser
        arguments: ["@facebook.comments_counter", "@facebook.likes_counter"]

    facebook.app:
        class: Outlandish\SocialMonitor\FacebookApp
        arguments: ["@facebook.request_factory", "@facebook.likes_counter", "@facebook.comments_counter", "@facebook.feed_fetcher", "@facebook_engagement.weighted"]

    # Headers

    table.header.handle:
        class: Outlandish\SocialMonitor\TableIndex\Header\Handle
        arguments: ["@translation.translator"]

    table.header.branding:
        class: Outlandish\SocialMonitor\TableIndex\Header\Branding
        arguments: ["@translation.translator"]

    table.header.sign_off:
        class: Outlandish\SocialMonitor\TableIndex\Header\SignOff
        arguments: ["@translation.translator"]

    table.header.total_rank:
        class: Outlandish\SocialMonitor\TableIndex\Header\TotalRank
        arguments: ["@translation.translator"]

    table.header.total_score:
        class: Outlandish\SocialMonitor\TableIndex\Header\TotalScore
        arguments: ["@translation.translator"]

    table.header.reach_score:
        class: Outlandish\SocialMonitor\TableIndex\Header\ReachScore
        arguments: ["@translation.translator"]

    table.header.engagement_score:
        class: Outlandish\SocialMonitor\TableIndex\Header\EngagementScore
        arguments: ["@translation.translator"]

    table.header.quality_score:
        class: Outlandish\SocialMonitor\TableIndex\Header\QualityScore
        arguments: ["@translation.translator"]

    table.header.current_audience:
        class: Outlandish\SocialMonitor\TableIndex\Header\CurrentAudience
        arguments: ["@translation.translator"]

    table.header.target_audience:
        class: Outlandish\SocialMonitor\TableIndex\Header\TargetAudience
        arguments: ["@translation.translator"]

    table.header.actions_per_day:
        class: Outlandish\SocialMonitor\TableIndex\Header\ActionsPerDay
        arguments: ["@translation.translator"]

    table.header.response_time:
        class: Outlandish\SocialMonitor\TableIndex\Header\ResponseTime
        arguments: ["@translation.translator"]

    table.header.options:
        class: Outlandish\SocialMonitor\TableIndex\Header\Options
        arguments: ["@translation.translator"]

    table.header.name:
        class: Outlandish\SocialMonitor\TableIndex\Header\Name
        arguments: ["@translation.translator"]

    table.header.digital_population:
        class: Outlandish\SocialMonitor\TableIndex\Header\DigitalPopulation
        arguments: ["@translation.translator"]

    table.header.digital_population_health:
        class: Outlandish\SocialMonitor\TableIndex\Header\DigitalPopulationHealth
        arguments: ["@translation.translator"]

    table.header.presences:
        class: Outlandish\SocialMonitor\TableIndex\Header\Presences
        arguments: ["@translation.translator"]

    table.header.presence_count:
        class: Outlandish\SocialMonitor\TableIndex\Header\PresenceCount
        arguments: ["@translation.translator"]

    table.header.countries:
        class: Outlandish\SocialMonitor\TableIndex\Header\Countries
        arguments: ["@translation.translator"]

    table.header.country_count:
        class: Outlandish\SocialMonitor\TableIndex\Header\CountryCount
        arguments: ["@translation.translator"]

    table.header.parent:
        class: Outlandish\SocialMonitor\TableIndex\Header\ParentName
        arguments: ["@translation.translator"]

    table.header.region_parent:
        class: Outlandish\SocialMonitor\TableIndex\Header\Region
        arguments: ["@translation.translator"]

    table.header.presence_type:
        class: Outlandish\SocialMonitor\TableIndex\Header\PresenceType
        arguments: ["@translation.translator"]

    # Index table data sources
    table.source.region:
        class: Outlandish\SocialMonitor\TableIndex\TableSource\RegionSource
    table.source.group:
        class: Outlandish\SocialMonitor\TableIndex\TableSource\GroupSource
    table.source.country:
        class: Outlandish\SocialMonitor\TableIndex\TableSource\CountrySource
    table.source.presence:
        class: Outlandish\SocialMonitor\TableIndex\TableSource\PresenceSource

    # Index Tables
    table.region-index:
        class: Outlandish\SocialMonitor\TableIndex\TableIndex
        arguments: ['region-index', "@table.source.region"]
        calls:
            - [addHeader, ["@table.header.name"]]
            - [addHeader, ["@table.header.total_rank"]]
            - [addHeader, ["@table.header.total_score"]]
            - [addHeader, ["@table.header.reach_score"]]
            - [addHeader, ["@table.header.engagement_score"]]
            - [addHeader, ["@table.header.quality_score"]]
            - [addHeader, ["@table.header.target_audience"]]
            - [addHeader, ["@table.header.current_audience"]]
            - [addHeader, ["@table.header.countries"]]
            - [addHeader, ["@table.header.country_count"]]
            - [addHeader, ["@table.header.presence_count"]]
            - [addHeader, ["@table.header.options"]]

    table.group-index:
        class: Outlandish\SocialMonitor\TableIndex\TableIndex
        arguments: ['group-index', "@table.source.group"]
        calls:
            - [addHeader, ["@table.header.name"]]
            - [addHeader, ["@table.header.total_rank"]]
            - [addHeader, ["@table.header.total_score"]]
            - [addHeader, ["@table.header.reach_score"]]
            - [addHeader, ["@table.header.engagement_score"]]
            - [addHeader, ["@table.header.quality_score"]]
            - [addHeader, ["@table.header.target_audience"]]
            - [addHeader, ["@table.header.current_audience"]]
            - [addHeader, ["@table.header.presences"]]
            - [addHeader, ["@table.header.presence_count"]]
            - [addHeader, ["@table.header.options"]]

    table.country-index:
        class: Outlandish\SocialMonitor\TableIndex\TableIndex
        arguments: ['country-index', "@table.source.country"]
        calls:
            - [addHeader, ["@table.header.name"]]
            - [addHeader, ["@table.header.region_parent"]]
            - [addHeader, ["@table.header.total_rank"]]
            - [addHeader, ["@table.header.total_score"]]
            - [addHeader, ["@table.header.reach_score"]]
            - [addHeader, ["@table.header.engagement_score"]]
            - [addHeader, ["@table.header.quality_score"]]
            - [addHeader, ["@table.header.target_audience"]]
            - [addHeader, ["@table.header.current_audience"]]
            - [addHeader, ["@table.header.digital_population"]]
            - [addHeader, ["@table.header.presences"]]
            - [addHeader, ["@table.header.presence_count"]]
            - [addHeader, ["@table.header.options"]]

    table.presence-index:
        class: Outlandish\SocialMonitor\TableIndex\TableIndex
        arguments: ['presence-index', "@table.source.presence"]
        calls:
            - [addHeader, ["@table.header.handle"]]
            - [addHeader, ["@table.header.parent"]]
            - [addHeader, ["@table.header.region_parent"]]
            - [addHeader, ["@table.header.presence_type"]]
            - [addHeader, ["@table.header.branding"]]
            - [addHeader, ["@table.header.sign_off"]]
            - [addHeader, ["@table.header.total_rank"]]
            - [addHeader, ["@table.header.total_score"]]
            - [addHeader, ["@table.header.reach_score"]]
            - [addHeader, ["@table.header.engagement_score"]]
            - [addHeader, ["@table.header.quality_score"]]
            - [addHeader, ["@table.header.current_audience"]]
            - [addHeader, ["@table.header.target_audience"]]
            - [addHeader, ["@table.header.options"]]

    history-query.total-population:
        class: Outlandish\SocialMonitor\Query\TotalPopularityHistoryDataQuery
        arguments: ["@pdo"]

    object-cache-manager:
        class: Outlandish\SocialMonitor\Cache\ObjectCacheManager
        arguments: ["@pdo", "@history-query.total-population"]
        calls:
            - [setPresencesTable, ["@table.presence-index"]]
            - [setCountriesTable, ["@table.country-index"]]
            - [setGroupsTable, ["@table.group-index"]]
            - [setRegionsTable, ["@table.region-index"]]

    # engagement metric query classes
    engagement-query.facebook:
        class: Outlandish\SocialMonitor\Engagement\Query\WeightedFacebookEngagementQuery
        arguments: ["@pdo"]
    engagement-query.instagram:
        class: Outlandish\SocialMonitor\Engagement\Query\WeightedInstagramEngagementQuery
        arguments: ["@pdo"]
    engagement-query.linkedin:
        class: Outlandish\SocialMonitor\Engagement\Query\WeightedLinkedinEngagementQuery
        arguments: ["@pdo"]
    engagement-query.sina-weibo:
        class: Outlandish\SocialMonitor\Engagement\Query\WeightedSinaWeiboEngagementQuery
        arguments: ["@pdo"]
    engagement-query.youtube:
        class: Outlandish\SocialMonitor\Engagement\Query\WeightedYoutubeEngagementQuery
        arguments: ["@pdo"]

    # metrics
    metric.actions-per-day:
        class: Metric_ActionsPerDay
    metric.branding:
        class: Metric_Branding
    metric.facebook-engagement:
        class: Metric_FBEngagement
        arguments: ["@engagement-query.facebook"]
    metric.instagram-engagement:
        class: Metric_InstagramEngagement
        arguments: ["@engagement-query.instagram"]
    metric.klout:
        class: Metric_Klout
    metric.likes-per-post:
        class: Metric_LikesPerPost
    metric.likes-per-view:
        class: Metric_LikesPerView
    metric.linkedin-engagement:
        class: Metric_LinkedinEngagement
        arguments: ["@engagement-query.linkedin"]
    metric.popularity:
        class: Metric_Popularity
    metric.popularity-time:
        class: Metric_PopularityTime
    metric.relevance:
        class: Metric_Relevance
    metric.response-ratio:
        class: Metric_ResponseRatio
    metric.response-time:
        class: Metric_ResponseTime
    metric.sign-off:
        class: Metric_SignOff
    metric.sina-weibo-engagement:
        class: Metric_SinaWeiboEngagement
        arguments: ["@engagement-query.sina-weibo"]
    metric.youtube-engagement:
        class: Metric_YoutubeEngagement
        arguments: ["@engagement-query.youtube"]

    # presence types
    presence-type.twitter:
        class: Outlandish\SocialMonitor\PresenceType\TwitterType
        arguments:
            - "@metric.klout"
            -
                - "@metric.actions-per-day"
                - "@metric.branding"
                - "@metric.popularity"
                - "@metric.popularity-time"
                - "@metric.relevance"
                - "@metric.sign-off"
                - "@metric.response-time"
                - "@metric.klout"
        calls:
            - [setProvider, ["@provider.twitter"]]

    presence-type.facebook:
        class: Outlandish\SocialMonitor\PresenceType\FacebookType
        arguments:
            - "@metric.facebook-engagement"
            -
                - "@metric.actions-per-day"
                - "@metric.branding"
                - "@metric.popularity"
                - "@metric.popularity-time"
                - "@metric.relevance"
                - "@metric.sign-off"
                - "@metric.facebook-engagement"
                - "@metric.likes-per-post"
                - "@metric.response-ratio"
                - "@metric.response-time"
        calls:
            - [setProvider, ["@provider.facebook"]]

    presence-type.instagram:
        class: Outlandish\SocialMonitor\PresenceType\InstagramType
        arguments:
            - "@metric.instagram-engagement"
            -
                - "@metric.popularity"
                - "@metric.popularity-time"
                - "@metric.actions-per-day"
                - "@metric.branding"
                - "@metric.sign-off"
                - "@metric.likes-per-post"
                - "@metric.instagram-engagement"
        calls:
            - [setProvider, ["@provider.instagram"]]

    presence-type.youtube:
        class: Outlandish\SocialMonitor\PresenceType\YoutubeType
        arguments:
            - "@metric.youtube-engagement"
            -
                - "@metric.popularity"
                - "@metric.popularity-time"
                - "@metric.branding"
                - "@metric.sign-off"
                - "@metric.youtube-engagement"
                - "@metric.likes-per-view"
        calls:
            - [setProvider, ["@provider.youtube"]]

    presence-type.linkedin:
        class: Outlandish\SocialMonitor\PresenceType\LinkedinType
        arguments:
            - "@metric.linkedin-engagement"
            -
                - "@metric.popularity"
                - "@metric.popularity-time"
                - "@metric.branding"
                - "@metric.sign-off"
                - "@metric.actions-per-day"
                - "@metric.relevance"
                - "@metric.linkedin-engagement"
        calls:
            - [setProvider, ["@provider.linkedin"]]

    presence-type.sina-weibo:
        class: Outlandish\SocialMonitor\PresenceType\SinaWeiboType
        arguments:
            - "@metric.sina-weibo-engagement"
            -
                - "@metric.actions-per-day"
                - "@metric.branding"
                - "@metric.popularity"
                - "@metric.popularity-time"
                - "@metric.relevance"
                - "@metric.sign-off"
                - "@metric.sina-weibo-engagement"
        calls:
            - [setProvider, ["@provider.sinaweibo"]]

    # badges
    badge.engagement:
        class: Badge_Engagement
        arguments:
            - "@pdo"
            -
                - "@metric.klout"
                - "@metric.facebook-engagement"
                - "@metric.sina-weibo-engagement"
                - "@metric.instagram-engagement"
                - "@metric.youtube-engagement"
                - "@metric.linkedin-engagement"

    badge.quality:
        class: Badge_Quality
        arguments:
            - "@pdo"
            -
                - "@metric.sign-off"
                - "@metric.relevance"
                - "@metric.branding"
                - "@metric.actions-per-day"
                - "@metric.response-time"
                - "@metric.likes-per-post"
                - "@metric.likes-per-view"

    badge.reach:
        class: Badge_Reach
        arguments:
            - "@pdo"
            -
                - "@metric.popularity"
                - "@metric.popularity-time"

    badge.total:
        class: Badge_Total
        arguments:
            - "@pdo"
            - ["@badge.reach", "@badge.engagement", "@badge.quality"]
