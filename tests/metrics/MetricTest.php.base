<?php

abstract class MetricTest extends PHPUnit_Framework_TestCase
{
	protected $metric;
	protected $emptyPresence;

	public function setUp()
	{
		parent::setUp();
        defined('APPLICATION_PATH')
        || define('APPLICATION_PATH', __DIR__ . '/../../application');
        require_once 'Zend/Loader/Autoloader.php';
        $autoloader = Zend_Loader_Autoloader::getInstance();
        $resourceLoader = new Zend_Application_Module_Autoloader(array(
            'namespace' => '',
            'basePath'  => APPLICATION_PATH
        ));
        $resourceLoader->addResourceType('exception', 'exceptions/', 'Exception');
        $resourceLoader->addResourceType('util', 'util/', 'Util');
        $resourceLoader->addResourceType('refactored', 'models/refactored/', 'NewModel');
        $resourceLoader->addResourceType('metric', 'metrics/', 'Metric');
        $resourceLoader->addResourceType('badge', 'badges/', 'Badge');

		$this->setUpMetric();

		$this->emptyPresence = $this->getMockBuilder('NewModel_Presence')
									->disableOriginalConstructor()
									->getMock()
		;
		$this->emptyPresence->method('getHistoricStream')->willReturn(null);
		$this->emptyPresence->method('getHistoricStreamMeta')->willReturn(null);
		$this->emptyPresence->method('getHistoricData')->willReturn(array());
		$this->emptyPresence->method('getFacebookEngagement')->willReturn(null);
		$this->emptyPresence->method('getKloutScore')->willReturn(null);
		$this->emptyPresence->method('getPopularity')->willReturn(0);
		$this->emptyPresence->method('getTargetAudienceDate')->willReturn(null);
		$this->emptyPresence->method('getTargetAudience')->willReturn(null);
		$this->emptyPresence->method('getRatioRepliesToOthersPosts')->willReturn(0);
		$this->emptyPresence->method('getResponseData')->willReturn(null);
	}

	abstract protected function setUpMetric();

	/**
	 * @group metrics
	 */
	public function testEmptyFacebookPresence() {
		$this->emptyPresence->method('getType')->willReturn(NewModel_PresenceType::FACEBOOK());
		$ret = $this->metric->calculate($this->emptyPresence, new DateTime('now -30 days'), new DateTime());
		$this->assertNull($ret);
	}

	/**
	 * @group metrics
	 */
	public function testEmptyTwitterPresence() {
		$this->emptyPresence->method('getType')->willReturn(NewModel_PresenceType::TWITTER());
		$ret = $this->metric->calculate($this->emptyPresence, new DateTime('now -30 days'), new DateTime());
		$this->assertNull($ret);
	}

	/**
	 * @group metrics
	 */
	public function testEmptySinaWeiboPresence() {
		$this->emptyPresence->method('getType')->willReturn(NewModel_PresenceType::SINA_WEIBO());
		$ret = $this->metric->calculate($this->emptyPresence, new DateTime('now -30 days'), new DateTime());
		$this->assertNull($ret);
	}
}