<?php //print_r($this->presence); ?>

<?php echo $this->render('partials/daterange.phtml'); ?>

<div id="share-box"><span class="link">Link to this page</span></div>

<div id="charts" data-controller="presence" data-controller-label="presence">

    <?php $presence = $this->presence; ?>

        <div class="presence <?php echo $presence->type; ?>">
            <a href="<?php echo $presence->page_url; ?>" target="_blank"><?php echo $presence->page_url; ?></a>
            <p>Info last updated: <?php echo $this->prettyDate($presence->last_updated, 'Never'); ?></p>
            <p>Statuses last updated: <?php echo $this->prettyDate($presence->last_fetched, 'Never'); ?></p>

            <?php
                foreach($this->graphs as $graph) {
                    $this->current = array('graph'=>$graph, 'presence'=>$presence);
                    echo $this->render('partials/chart.phtml');
                }
            ?>

        </div>


</div>

<div class="presence <?php echo $this->presence->type; ?>">
	<a href="<?php echo $this->presence->page_url; ?>" target="_blank"><?php echo $this->presence->page_url; ?></a>
</div>
<p>Info last updated: <?php echo $this->prettyDate($this->presence->last_updated, 'Never'); ?></p>
<p>Statuses last updated: <?php echo $this->prettyDate($this->presence->last_fetched, 'Never'); ?></p>

<div id="charts" data-controller="presence" data-controller-label="presence">
	<?php foreach ($this->graphs as $graph) : ?>
	<div class="chart-container">
		<div class="health">
			<h3 class="title"><?php echo $graph->title; ?></h3>
			<div class="fieldset">
				<h4 class="legend"></h4>
				<p class="value"></p>
			</div>
			<p class="target"></p>
		</div>
		<div id="<?php echo $graph->id; ?>" class="chart" data-y-label="<?php echo $graph->yAxisLabel; ?>" data-line-id="<?php echo $graph->lineId; ?>">
			<div class="downloadChart">Download as <span class="link">PNG</span> or <span class="link">SVG</span></div>
		</div>
		<div class="clearfix"></div>
	</div>
	<?php endforeach; ?>
</div>

<div id="statuses" class="statusesDisplay <?php echo $this->presence->type; ?>">
	<div class="inner">
		<h3>Statuses</h3>
		<table>
			<thead>
				<tr>
				<?php if ($this->presence->type == Model_Presence::TYPE_FACEBOOK) : ?>
					<th class="user">User</th>
					<th class="message">Message</th>
					<th class="response">Response</th>
					<th class="date">Date</th>
				<?php else : ?>
					<th class="message">Message</th>
					<th class="date">Date</th>
				<?php endif; ?>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
</div>
