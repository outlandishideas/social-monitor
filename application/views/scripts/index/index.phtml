<?php
use Outlandish\SocialMonitor\PresenceType\PresenceType;

/** @var \Symfony\Component\Translation\Translator $translator */
$translator = $this->translate();

/** @var Badge_Abstract[] $allBadges */
$allBadges = $this->badges;
?>

<div class="row">
    <div class="small-24 large-5 columns homepage-title">
        <h2 class="page-title"><?php echo $this->pageTitle ?></h2>
        <span class="help-text-toggle icon-question-sign icon-large">
            <div class="help-text">
                <p><?php echo $translator->trans('route.index.index.contextual-help.page-title')?></p>
            </div>
        </span>
    </div>
    <div class="columns large-19" id="homepage-tabs">
        <div class="small-24 large-17 columns">
                <dl id="kpi-tabs" class="tabs">
                <?php foreach($allBadges as $badge) : ?>
                    <dd data-badge="<?php echo $badge->getName(); ?>" data-title="<?php echo $badge->getTitle(); ?>">
                        <a href="#<?php echo $badge->getName(); ?>"><?php echo $badge->getTitle(); ?></a>
                    </dd>
                <?php endforeach; ?>
                </dl>
        </div>
    <?php if ($this->pdfLink) : ?>
        <div class="small-24 large-7 show-for-large-up columns pdflink">
                <div id="kpi-download-button">
                    <ul class="button-group">
                        <li>
                            <a
                                href="<?php echo $this->pdfLink; ?>"
                                target="_blank"
                                title="<?php echo $translator->trans('route.index.index.pdf-download-link-title')?>"
                                class="button-bc"
                                download="metrics.pdf"
                            >
                                <?php echo $translator->trans('route.index.index.pdf-download-link')?>
                            </a>
                        </li>
                    </ul>
                </div>
        </div>
    <?php endif; ?>
    </div>
</div>

<div class="row">
    <div class="small-24 large-5 columns hide-for-small-down">
        <span class="help-text-toggle icon-question-sign icon-large">
            <div class="help-text">
                <p><?php echo $translator->trans('route.index.index.contextual-help.date-range')?></p>
            </div>
        </span>

        <div id="map-date" class="bd-btm" data-current-date="<?php echo $this->currentDate; ?>" data-day-range="<?php echo $this->dayRange; ?>">
            <h4><?php echo $translator->trans('route.index.index.date-range')?></h4>
            <div class="date-range-text"></div>
            <div class="range-slider" data-slider="<?php echo $this->dayRange; ?>" data-options="start: 1; end: <?php echo $this->dayRange; ?>; step: 1">
                <span class="range-slider-handle" role="slider" tabindex="0"></span>
                <span class="range-slider-active-segment"></span>
                <input type="hidden">
            </div>
        </div>

        <div id="find-country" class="find-country">
            <form onsubmit="return app.home.selectCountry()">
                <label for="search-countries"><?php echo $translator->trans('route.index.index.find-country')?></label>
                <input type="text" id="search-countries" oninput="app.home.searchCountries()" />
            </form>
            <ul class="country-list">
            </ul>
        </div>

        <?php foreach($allBadges as $badge): ?>
        <div class="badge-description" data-badge-name="<?php echo $badge->getName(); ?>">
            <?php echo $badge->getDescription(); ?>
        </div>
        <?php endforeach; ?>

    </div>
    <div class="small-24 large-14 columns">
		<div id="map-top"></div>
        <div id="map">
            <span class="help-text-toggle icon-question-sign icon-large">
                <div class="help-text">
                    <p><?php echo $translator->trans('route.index.index.contextual-help.map')?></p>
                </div>
            </span>
            <div id="geo-map"></div>
        </div>
    </div>
    <div class="small-24 large-5 columns">
        <div id="country-stats" class="global">
            <!-- overall score now inserted in app.home.setup() because we use a template that we can insert and remove -->
        </div>
    </div>
</div>

<?php if(isset($this->groups) && count($this->groups) > 0): ?>
    <h2><?php echo $translator->trans('Global.groups')?></h2>
    <div class="row">
        <div class="small-24 large-23 large-centered columns">
            <div class="row">
                <?php foreach($this->groups as $group): /** @var Model_Group $group */ ?>
                    <div class="small-24 large-8 columns">
                        <div class="badge-small" data-group-id="<?php echo $group->id ?>" data-badge>
                            <h3><a href="<?php echo $this->url(array('controller'=>'group', 'action'=>'view', 'id'=>$group->id)); ?>"><?php echo $group->display_name; ?></a></h3>
                            <div class="badge-score bd-btm">
                                <h4><span data-badge-title></span> <?php echo $translator->trans('Global.score')?></h4>
                                <div class="score-value" data-badge-score="%"></div>
                                <div class="score-bar">
                                    <div data-badge-bar></div>
                                </div>
                            </div>
                            <div class="bd-btm badge-presences-buttons">
                                <ul class="small-block-grid-3">
                                    <li>
                                        <a href="#all">
                                            <h4><?php echo $translator->trans('Global.presences')?></h4>
                                            <div class="score-value"><?php echo count($group->getPresences()) ?></div>
                                        </a>
                                    </li>
                                    <?php foreach (PresenceType::getAll() as $type) : ?>
                                        <?php $typePresences = $group->getPresencesByType($type); ?>
                                        <?php if ($typePresences) : ?>
                                        <li>
                                            <a href="#<?php echo $type->getValue(); ?>">
                                                <h4><?php echo $type->getTitle(); ?></h4>
                                                <div class="score-value"><?php echo count($typePresences); ?></div>
                                            </a>
                                        </li>
                                        <?php endif; ?>
                                    <?php endforeach; ?>
                                </ul>
                            </div>
                            <div class="hide-for-small-down">
                                <ul class="badge-presences">
                                    <?php foreach($group->getPresences() as $presence) : /** @var $presence Model_Presence */ ?>
                                        <li data-presence-type="<?php echo $presence->getType()->getValue(); ?>">
                                            <a href="<?php echo $this->url(array('controller'=>'presence', 'action'=>'view', 'id'=>$presence->getId())); ?>">
                                                <span class="white-background <?php echo $presence->getPresenceSign(); ?> fixed-width"></span> <?php echo $presence->getHandle(); ?>
                                                <?php $score = $presence->getEngagementScore(); ?>
                                                <span class="flag-score <?php echo $score->getType(); ?>"
                                                      title="<?php echo $score->getName(); ?>: <?php echo $score->getScore(); ?>">
                                                    <?php echo round($score->getScore()); ?>
                                                </span>
                                            </a>
                                        </li>
                                    <?php endforeach; ?>
                                </ul>
                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>
    </div>
<?php endif; ?>

<?php if ($this->pdfLink) : ?>
<div class="button-bc-bar pdflink">
    <div class="row bk-dark">
        <div class="small-24 columns" id="kpi-download">
            <p><?php echo $translator->trans('route.index.index.pdf-download-description')?></p>
            <ul class="button-group">
                <li>
                    <a
                        href="<?php echo $this->pdfLink; ?>"
                        target="_blank"
                        title="<?php echo $translator->trans('route.index.index.pdf-download-link-title')?>"
                        class="button-bc"
                        download="metrics.pdf"
                    >
                        <?php echo $translator->trans('route.index.index.pdf-download-link')?>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
<?php endif; ?>

<?php echo $this->joyride->renderHtml(); ?>

<!---->
<!--<ol id="joyride-home" class="joyride-list" data-joyride>-->
<!--	<li data-text="Next" data-options="tip_location: top; prev_button: false">-->
<!--		<p>Hello and welcome to the British Council Social Monitor.</p>-->
<!--	</li>-->
<!--	<li data-id="map-top" data-class="custom so-awesome" data-options="tip_location: bottom;" data-text="Next" data-prev-text="Prev">-->
<!--		<h4>A world view</h4>-->
<!--		<p>This map gives you an overview of all the countries that the British Council has Social Media channels in.<br/>-->
<!--			If you the country is grey, that means the British Council doesn't have any Social Media channels there.</p>-->
<!--	</li>-->
<!--	<li data-id="find-country" data-button="Next" data-prev-text="Prev" data-options="tip_location:top;tip_animation:fade">-->
<!--		<h4>Can't find what you're looking for?</h4>-->
<!--		<p>You can search for any country here. Great for those small countries that can be a bit difficult to click on.</p>-->
<!--	</li>-->
<!--	<li data-id="map-date" data-button="Next" data-prev-text="Prev" data-options="tip_location:top;tip_animation:fade">-->
<!--		<h4>Zoom into the past!</h4>-->
<!--		<p>You can find out how the Social Media channels have changed over time using this Date Range slider.</p>-->
<!--	</li>-->
<!--	<li data-id="kpi-tabs" data-button="Next" data-prev-text="Prev" data-options="tip_location:top;tip_animation:fade">-->
<!--		<h4>How we measure Social Media</h4>-->
<!--		<p>We've broken up the scores of each of the Social Media channels into three different KPIs: Reach, Engagement and Quality. You can use the tabs here to see the scores for that individual KPI.</p>-->
<!--	</li>-->
<!--	<li data-id="kpi-download-button" data-button="Next" data-prev-text="Prev" data-options="tip_location:top;tip_animation:fade">-->
<!--		<h4>Find out more</h4>-->
<!--		<p>To find out more about the different KPIs that we use to measure the Social Media channels, you can download the accompanying PDF here.</p>-->
<!--	</li>-->
<!--	<li data-button="End" data-prev-text="Prev">-->
<!--		<h4>The End</h4>-->
<!--		<p>Please send us any feedback.</p>-->
<!--	</li>-->
<!--</ol>-->

<script type='text/javascript' src='https://www.google.com/jsapi'></script>
<script type='text/javascript'>
    var mapArgs = <?php echo json_encode($this->mapArgs); ?>;
</script>
